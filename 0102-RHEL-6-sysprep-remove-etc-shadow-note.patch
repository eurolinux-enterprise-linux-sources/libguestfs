From a03518fe2d64e3dd81934c92e79e9bb143bbcc7b Mon Sep 17 00:00:00 2001
From: Pino Toscano <ptoscano@redhat.com>
Date: Thu, 15 Jan 2015 10:56:53 -0500
Subject: [PATCH 102/102] RHEL 6: sysprep: remove /etc/shadow note

Once RHBZ#1160261 is in and we can require the augeas providing it,
virt-sysprep will remove users from /etc/shadow too; hence, remove
the documentation note (and the code comment) mentioning that issue.

Related to RHBZ#1138630.
---
 sysprep/sysprep_operation_user_account.ml | 8 --------
 1 file changed, 8 deletions(-)

diff --git a/sysprep/sysprep_operation_user_account.ml b/sysprep/sysprep_operation_user_account.ml
index b44fbfb..3e24b47 100644
--- a/sysprep/sysprep_operation_user_account.ml
+++ b/sysprep/sysprep_operation_user_account.ml
@@ -46,10 +46,6 @@ let user_account_perform g root =
           let username =
             let i = String.rindex userpath '/' in
             String.sub userpath (i+1) (String.length userpath -i-1) in
-          (* XXX Augeas doesn't yet have a lens for /etc/shadow, so the
-           * next line currently does nothing, but should start to
-           * work in a future version.
-           *)
           g#aug_rm (sprintf "/files/etc/shadow/%s" username);
           g#aug_rm (sprintf "/files/etc/group/%s" username);
           g#rm_rf ("/home/" ^ username)
@@ -68,10 +64,6 @@ let op = {
     pod_description = Some (s_"\
 Remove all the user accounts and their home directories.
 The \"root\" account is not removed.");
-    pod_notes = Some (s_"\
-Currently this does not remove the user accounts from
-C</etc/shadow>.  This is because there is no lens for
-the shadow password file in Augeas.");
     perform_on_filesystems = Some user_account_perform;
 }
 
-- 
1.9.3

